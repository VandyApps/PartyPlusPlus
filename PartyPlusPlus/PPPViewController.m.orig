//
//  PPPViewController.m
//  PartyPlusPlus
//
//  Created by Scott Andrus on 10/12/12.
//  Copyright (c) 2012 Tapatory. All rights reserved.
//

#import "PPPViewController.h"
<<<<<<< HEAD
#import "UIView+Frame.h"
#import "SAViewManipulator.h"
#import <QuartzCore/QuartzCore.h>
=======
#import "PPPAppDelegate.h"
>>>>>>> fbook_login

@interface PPPViewController ()

@end

@implementation PPPViewController

<<<<<<< HEAD
#pragma mark - View Controller lifecycle
=======
#pragma mark - Helper methods

/*
 * Configure the logged in versus logged out UX
 */
- (void)sessionStateChanged:(NSNotification*)notification {
    if (FBSession.activeSession.isOpen) {
        [self populateUserDetails];
    } else {
        [self performSegueWithIdentifier:@"DisplayLoginViewController" sender:self];
    }
}


- (void)populateUserDetails {
    PPPAppDelegate *appDelegate = [[UIApplication sharedApplication] delegate];
    [appDelegate requestUserData:^(id sender, id<FBGraphUser> user) {
        NSLog(@"%@", user.name);
    }];
}
  
>>>>>>> fbook_login

- (void)viewDidLoad
{
    [super viewDidLoad];
    
    // Register for notifications on FB session state changes
    [[NSNotificationCenter defaultCenter]
     addObserver:self
     selector:@selector(sessionStateChanged:)
     name:FBSessionStateChangedNotification
     object:nil];
    
	// Do any additional setup after loading the view, typically from a nib.
<<<<<<< HEAD
    
    [self customizeUI];
    [self setupMainEventsScrollView];
    
    self.pageLabel.text = [NSString stringWithFormat:@"%d out of %d", 1, self.events.count];
=======
    [self.navigationController performSegueWithIdentifier:@"DisplayLoginViewController" sender:self];
>>>>>>> fbook_login

}

- (void)didReceiveMemoryWarning
{
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

- (void)viewDidUnload {
    [self setCurrentEvent:nil];
    [self setMainEventsScrollView:nil];
    [self setTertiaryEventsScrollview:nil];
    [self setBackgroundView:nil];
    [self setPageLabel:nil];
    [super viewDidUnload];
}

#pragma mark - Utility methods

- (void)customizeUI {
    [SAViewManipulator setGradientBackgroundImageForView:self.backgroundView withTopColor:[UIColor colorWithRed:0.875 green:0.875 blue:0.875 alpha:1] /*#dfdfdf*/ andBottomColor:[UIColor colorWithRed:0.549 green:0.549 blue:0.549 alpha:1] /*#8c8c8c*/];
    
    // Set a gradient on the navigation bar
    [SAViewManipulator setGradientBackgroundImageForView:self.navigationController.navigationBar withTopColor:nil andBottomColor:nil];
    
    // Round the navigation bar
    [SAViewManipulator roundNavigationBar:self.navigationController.navigationBar];
}

- (void)setupMainEventsScrollView {
    
    // Round current event
    [self styleMainEventView:self.currentEvent];
    
    // Create a mutable array to mutate events
    NSMutableArray *mutableEvents = [NSMutableArray arrayWithObjects:self.currentEvent, nil];
    
    // Create a main event view pointer
    PPPMainEventView *view;
    
    // Create 10 events
    for (size_t i = 1; i < 10; ++i) {
        
        // Allocate and initialize the event
        view = [[PPPMainEventView alloc] init];
        
        // Set the labels
        view.eventNameLabel.text = [NSString stringWithFormat:@"Event %zu", i + 1];
        view.placeLabel.text = @"Vanderbilt";
        
        [view.detailButton addTarget:self action:@selector(goToDetail:) forControlEvents:UIControlEventTouchUpInside];
        
        // Add it to the subview
        [self.mainEventsScrollView addSubview:view];
        
        // Grab the one from interface builder
        view.origin = self.currentEvent.origin;
        view.left += self.mainEventsScrollView.width * i;
        
        // Add it to the list of mutable events
        [mutableEvents addObject:view];
    }
    
    // Put it into the events array
    self.events = [mutableEvents copy];
    
    self.currentEvent.eventNameLabel.text = @"HackNashville";
    self.currentEvent.placeLabel.text = @"Emma";
    
    self.mainEventsScrollView.contentSize = CGSizeMake(self.events.count * self.mainEventsScrollView.width, self.mainEventsScrollView.height);
}

- (void)goToDetail:(PPPMainEventView *)detail {
    [self performSegueWithIdentifier:@"goToDetail" sender:nil];
}

- (void)styleMainEventView:(PPPMainEventView *)mainEventView {
    mainEventView.clipsToBounds = YES;
    [SAViewManipulator addBorderToView:mainEventView withWidth:2 color:[UIColor blackColor] andRadius:10];
}

#pragma mark - UIScrollView delegate

- (void)scrollViewDidScroll:(UIScrollView *)sender {
    // Update the page when more than 50% of the previous/next page is visible
    CGFloat pageWidth = self.mainEventsScrollView.width;
    int page = floor((self.mainEventsScrollView.contentOffset.x - pageWidth / 2) / pageWidth) + 1;
    self.pageLabel.text = [NSString stringWithFormat:@"%d out of %d", page + 1, self.events.count];
}

@end
